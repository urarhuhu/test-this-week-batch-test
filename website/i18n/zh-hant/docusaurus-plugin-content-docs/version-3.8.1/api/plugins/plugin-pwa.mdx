---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

Docusaurus æ’ä»¶ï¼Œä½¿ç”¨ [Workbox](https://developers.google.com/web/tools/workbox) æ·»åŠ  PWA æ”¯æ´ã€‚æ­¤æ’ä»¶åƒ…åœ¨ç”Ÿç”¢ç’°å¢ƒæ§‹å»ºæ™‚ç”Ÿæˆ [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers)ï¼Œè®“æ‚¨èƒ½å‰µå»ºå®Œå…¨ç¬¦åˆ PWA è¦ç¯„çš„æ–‡æª”ç«™é»ï¼Œå…·å‚™é›¢ç·šå’Œå®‰è£æ”¯æ´åŠŸèƒ½ã€‚

## å®‰è£ {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## é…ç½® {#configuration}

åœ¨ `./static/manifest.json` å‰µå»º [PWA æ¸…å–®æ–‡ä»¶](https://web.dev/add-manifest/)ã€‚

ä¿®æ”¹ `docusaurus.config.js` åŠ å…¥æœ€å°åŒ– PWA é…ç½®ï¼Œä¾‹å¦‚ï¼š

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // your PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## æ¼¸é€²å¼ç¶²è·¯æ‡‰ç”¨ {#progressive-web-app}

åƒ…å®‰è£ service worker ä¸¦ä¸è¶³ä»¥ä½¿æ‚¨çš„æ‡‰ç”¨æˆç‚º PWAã€‚æ‚¨è‡³å°‘éœ€è¦åŒ…å« [Web æ‡‰ç”¨æ¸…å–®](https://developer.mozilla.org/en-US/docs/Web/Manifest) ä¸¦åœ¨ `<head>` ä¸­æ·»åŠ æ­£ç¢ºçš„æ¨™ç±¤ï¼ˆåƒè¦‹ [é¸é … > pwaHead](#pwahead)ï¼‰ã€‚

éƒ¨ç½²å¾Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [Lighthouse](https://developers.google.com/web/tools/lighthouse) å°ç«™é»é€²è¡Œå¯©æ ¸ã€‚

æœ‰é—œç«™é»æˆç‚º PWA çš„å®Œæ•´è¦æ±‚æ¸…å–®ï¼Œè«‹åƒè€ƒ [PWA æª¢æŸ¥è¡¨](https://developers.google.com/web/progressive-web-apps/checklist)

## æ‡‰ç”¨å®‰è£æ”¯æ´ {#app-installation-support}

å¦‚æœç€è¦½å™¨æ”¯æ´ï¼Œæ‚¨æ‡‰è©²èƒ½å¤ å°‡ Docusaurus ç«™é»ä½œç‚ºæ‡‰ç”¨å®‰è£ã€‚

![æ‡‰ç”¨å®‰è£éç¨‹çš„è¢å¹•éŒ„å½±ã€‚ç€è¦½å™¨åœ°å€æ¬„ä¸­å‡ºç¾ä¸€å€‹æŒ‰éˆ•ï¼Œé»æ“Šå¾Œé¡¯ç¤ºã€Œå®‰è£æ­¤æ‡‰ç”¨ç¨‹å¼ï¼Ÿã€çš„å°è©±æ¡†ã€‚é»æ“Šã€Œå®‰è£ã€æŒ‰éˆ•å¾Œï¼Œæ“ä½œç³»çµ±ä¸­æœƒæ‰“é–‹ä¸€å€‹æ–°æ‡‰ç”¨ç¨‹å¼ï¼Œé¡¯ç¤º Docusaurus é¦–é ã€‚](/img/pwa_install.gif)

:::note

æ‡‰ç”¨å®‰è£éœ€è¦ HTTPS å”è­°å’Œæœ‰æ•ˆçš„æ¸…å–®æ–‡ä»¶ã€‚

:::

## é›¢ç·šæ¨¡å¼ï¼ˆé ç·©å­˜ï¼‰ {#offline-mode-precaching}

æˆ‘å€‘é€šé service-worker é ç·©å­˜æŠ€è¡“ï¼Œè®“ç”¨æˆ¶èƒ½åœ¨é›¢ç·šç‹€æ…‹ä¸‹ç€è¦½ Docusaurus ç«™é»ã€‚

[workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching) é é¢è§£é‡‹äº†å…¶åŸç†ï¼š

> Service worker çš„ä¸€å€‹ç‰¹æ€§æ˜¯èƒ½åœ¨å®‰è£æ™‚å°‡ä¸€çµ„æ–‡ä»¶ä¿å­˜åˆ°ç·©å­˜ä¸­ã€‚é€™é€šå¸¸ç¨±ç‚ºã€Œé ç·©å­˜ã€ï¼Œå› ç‚ºæ‚¨æ˜¯åœ¨ service worker è¢«ä½¿ç”¨å‰å°±ç·©å­˜å…§å®¹ã€‚
>
> é€™æ¨£åšçš„ä¸»è¦åŸå› æ˜¯è®“é–‹ç™¼è€…èƒ½æ§åˆ¶ç·©å­˜ï¼Œæ„å‘³è‘—ä»–å€‘å¯ä»¥æ±ºå®šæ–‡ä»¶ä½•æ™‚è¢«ç·©å­˜ã€ç·©å­˜å¤šä¹…ï¼Œä»¥åŠä¸é€šéç¶²è·¯ç›´æ¥æä¾›çµ¦ç€è¦½å™¨ï¼Œå¾è€Œå‰µå»ºå¯é›¢ç·šé‹è¡Œçš„ç¶²è·¯æ‡‰ç”¨ã€‚
>
> Workbox é€šéç°¡åŒ– API ä¸¦ç¢ºä¿è³‡æºé«˜æ•ˆä¸‹è¼‰ï¼Œå¤§å¹…æ¸›è¼•äº†é ç·©å­˜çš„è¤‡é›œæ€§ã€‚

é è¨­æƒ…æ³ä¸‹ï¼Œç•¶ç«™é»ä½œç‚ºæ‡‰ç”¨å®‰è£æ™‚æœƒå•Ÿç”¨é›¢ç·šæ¨¡å¼ã€‚è©³è¦‹ `offlineModeActivationStrategies` é¸é …èªªæ˜ã€‚

ç«™é»å®Œæˆé ç·©å­˜å¾Œï¼Œservice worker å°‡ç‚ºå¾ŒçºŒè¨ªå•æä¾›ç·©å­˜éŸ¿æ‡‰ã€‚ç•¶æ–°ç‰ˆæœ¬éƒ¨ç½²ä¸¦ä¼´éš¨æ–°çš„ service worker æ™‚ï¼Œæ–°ç‰ˆæœ¬æœƒé–‹å§‹å®‰è£ä¸¦æœ€çµ‚é€²å…¥ç­‰å¾…ç‹€æ…‹ã€‚åœ¨æ­¤ç­‰å¾…ç‹€æ…‹æœŸé–“ï¼Œå°‡é¡¯ç¤ºé‡æ–°è¼‰å…¥å½ˆçª—ï¼Œè¦æ±‚ç”¨æˆ¶åˆ·æ–°é é¢ä»¥ç²å–æ–°å…§å®¹ã€‚åœ¨ç”¨æˆ¶æ¸…é™¤æ‡‰ç”¨ç·©å­˜æˆ–é»æ“Šå½ˆçª—ä¸­çš„ `reload` æŒ‰éˆ•å‰ï¼Œservice worker å°‡æŒçºŒæä¾›èˆŠå…§å®¹ã€‚

:::warning

é›¢ç·šæ¨¡å¼/é ç·©å­˜éœ€è¦æå‰ä¸‹è¼‰ç«™é»æ‰€æœ‰éœæ…‹è³‡æºï¼Œå¯èƒ½æ¶ˆè€—ä¸å¿…è¦çš„é »å¯¬ã€‚å°æ–¼æŸäº›é¡å‹çš„ç«™é»ï¼Œå•Ÿç”¨æ­¤åŠŸèƒ½å¯èƒ½ä¸¦éå¥½ä¸»æ„ã€‚

:::

## é¸é … {#options}

### `debug` {#debug}

- é¡å‹: `boolean`
- é è¨­å€¼: `false`

å•Ÿç”¨é™¤éŒ¯æ¨¡å¼ï¼š

- Workbox æ—¥èªŒ
- é¡å¤–çš„ Docusaurus æ—¥èªŒ
- æœªå„ªåŒ–çš„ SW æª”æ¡ˆè¼¸å‡º
- åŸå§‹ç¢¼æ˜ å°„

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- é¡å‹: `('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- é è¨­å€¼: `['appInstalled', 'queryString', 'standalone']`

å•Ÿç”¨é›¢ç·šæ¨¡å¼çš„ç­–ç•¥ï¼š

- `appInstalled`: å°å·²å°‡ç¶²ç«™å®‰è£ç‚ºæ‡‰ç”¨çš„ä½¿ç”¨è€…å•Ÿç”¨ï¼ˆä¸¦é 100% å¯é ï¼‰
- `standalone`: å°ä»¥ç¨ç«‹æ‡‰ç”¨æ¨¡å¼é‹è¡Œçš„ä½¿ç”¨è€…å•Ÿç”¨ï¼ˆé€šå¸¸æ˜¯ PWA å®‰è£å¾Œçš„æƒ…æ³ï¼‰
- `queryString`: ç•¶æŸ¥è©¢å­—ä¸²åŒ…å« `offlineMode=true` æ™‚å•Ÿç”¨ï¼ˆæ–¹ä¾¿ PWA é™¤éŒ¯ï¼‰
- `mobile`: å°è¡Œå‹•è£ç½®ä½¿ç”¨è€…å•Ÿç”¨ï¼ˆ`width <= 996px`ï¼‰
- `saveData`: å° `navigator.connection.saveData === true` çš„ä½¿ç”¨è€…å•Ÿç”¨
- `always`: å°æ‰€æœ‰ä½¿ç”¨è€…å•Ÿç”¨

:::warning

è¬¹æ…ä½¿ç”¨æ­¤åŠŸèƒ½ï¼šéƒ¨åˆ†ä½¿ç”¨è€…å¯èƒ½ä¸å–œæ­¡è¢«å¼·åˆ¶ä½¿ç”¨é›¢ç·šæ¨¡å¼ã€‚

:::

:::danger

ç„¡æ³•ä»¥å¯é æ–¹å¼æª¢æ¸¬é é¢æ˜¯å¦ä»¥ PWA å½¢å¼æ¸²æŸ“ã€‚

`appinstalled` äº‹ä»¶å·²[å¾è¦ç¯„ä¸­ç§»é™¤](https://github.com/w3c/manifest/pull/836)ï¼Œä¸” [`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) API åƒ…åœ¨æœ€æ–°ç‰ˆ Chrome ä¸­æ”¯æ´ï¼Œä¸¦éœ€åœ¨ manifest ä¸­å®£å‘Š `related_applications`ã€‚

[`standalone` ç­–ç•¥](https://petelepage.com/blog/2019/07/is-my-pwa-installed/)æ˜¯å•Ÿç”¨é›¢ç·šæ¨¡å¼çš„è‰¯å¥½å‚™ç”¨æ–¹æ¡ˆï¼ˆè‡³å°‘åœ¨ä½¿ç”¨å·²å®‰è£æ‡‰ç”¨æ™‚æœ‰æ•ˆï¼‰ã€‚

:::

### `injectManifestConfig` {#injectmanifestconfig}

å‚³éçµ¦ `workbox.injectManifest()` çš„ [Workbox é¸é …](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions)ã€‚æ­¤é¸é …å¯è®“æ‚¨æ§åˆ¶å“ªäº›è³‡æºæœƒè¢«é å…ˆå¿«å–ä¸¦åœ¨é›¢ç·šæ™‚å¯ç”¨ã€‚

- é¡å‹: `InjectManifestOptions`
- é è¨­å€¼: `{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // We already add regular static assets (HTML, images...) to be available offline
          // You can add more files according to your needs
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- é¡å‹: `({ tagName: string; [attributeName: string]: string })[]`
- é è¨­å€¼: `[]`

åŒ…å« `tagName` å’Œå±¬æ€§éµå€¼å°çš„ç‰©ä»¶é™£åˆ—ï¼Œç”¨æ–¼æ³¨å…¥ `<head>` æ¨™ç±¤ã€‚æŠ€è¡“ä¸Šæ‚¨å¯ä»¥é€éæ­¤æ–¹å¼æ³¨å…¥ä»»ä½• head æ¨™ç±¤ï¼Œä½†ç†æƒ³æƒ…æ³ä¸‹æ‡‰ç”¨æ–¼ä½¿ç¶²ç«™ç¬¦åˆ PWA è¦ç¯„çš„æ¨™ç±¤ã€‚ä»¥ä¸‹æ˜¯ä½¿æ‡‰ç”¨å®Œå…¨åˆè¦çš„æ¨™ç±¤åˆ—è¡¨ï¼š

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- é¡å‹: `string | undefined`
- é è¨­å€¼: `undefined`

é©ç”¨æ–¼é¡å¤–çš„ Workbox è¦å‰‡ã€‚æ‚¨å¯ä»¥åœ¨é€™è£¡åŸ·è¡Œä»»ä½• service worker èƒ½åšçš„äº‹ï¼Œä¸¦å……åˆ†åˆ©ç”¨ workbox å‡½å¼åº«çš„åŠŸèƒ½ã€‚ç¨‹å¼ç¢¼æœƒè¢«è½‰è­¯ï¼Œå› æ­¤å¯ä½¿ç”¨ç¾ä»£ ES6+ èªæ³•ã€‚

ä¾‹å¦‚ï¼Œå¿«å–å¤–éƒ¨è·¯ç”±çš„æª”æ¡ˆï¼š

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// default fn export receiving some useful params
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // Cache responses from external resources
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

æ¨¡çµ„æ‡‰å…·æœ‰ `default` å‡½å¼åŒ¯å‡ºï¼Œä¸¦æ¥æ”¶ä¸€äº›åƒæ•¸ã€‚

### `swRegister` {#swregister}

- é¡å‹: `string | false`
- é è¨­å€¼: `'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨ Docusaurus æ‡‰ç”¨å‰æ·»åŠ ä¸€å€‹å…¥å£ï¼Œä»¥ä¾¿è¨»å†Šèƒ½åœ¨æ‡‰ç”¨é‹è¡Œå‰å®Œæˆã€‚é è¨­çš„ `registerSW.js` æª”æ¡ˆå·²è¶³å¤ é€²è¡Œç°¡å–®è¨»å†Šã€‚

å‚³é `false` å°‡å®Œå…¨åœç”¨è¨»å†ŠåŠŸèƒ½ã€‚

## Manifest ç¯„ä¾‹ {#manifest-example}

Docusaurus ç¶²ç«™æ¸…å–®å¯ä½œç‚ºåƒè€ƒç¯„ä¾‹ï¼š

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>
```

## è‡ªè¨‚é‡æ–°è¼‰å…¥å½ˆå‡ºè¦–çª— {#customizing-reload-popup}

ç•¶æ–°çš„ Service Worker ç­‰å¾…å®‰è£æ™‚ï¼Œæœƒæ¸²æŸ“ `@theme/PwaReloadPopup` å…ƒä»¶ä¸¦å»ºè­°ä½¿ç”¨è€…é‡æ–°è¼‰å…¥é é¢ã€‚æ‚¨å¯ä»¥[æ›¿æ›](../../swizzling.mdx)æ­¤å…ƒä»¶ä¸¦å¯¦ä½œè‡ªå·±çš„ UI ä»‹é¢ã€‚è©²å…ƒä»¶æœƒæ¥æ”¶ä¸€å€‹ `onReload` å›èª¿å‡½å¼ä½œç‚º propsï¼Œæ‡‰åœ¨ä½¿ç”¨è€…é»æ“Šã€Œé‡æ–°è¼‰å…¥ã€æŒ‰éˆ•æ™‚å‘¼å«æ­¤å‡½å¼ï¼Œé€™å°‡æŒ‡ç¤º Service Worker å®‰è£ç­‰å¾…ä¸­çš„ç‰ˆæœ¬ä¸¦é‡æ–°æ•´ç†é é¢ã€‚

é è¨­ä¸»é¡Œå·²å…§å»ºé‡æ–°è¼‰å…¥å½ˆå‡ºè¦–çª—çš„å¯¦ä½œï¼Œæ¡ç”¨ [Infima è­¦ç¤ºæ¡†](https://infima.dev/docs/components/alert)æ¨£å¼ã€‚

![é‡æ–°è¼‰å…¥æµç¨‹çš„ç•«é¢éŒ„è£½ã€‚è¦–çª—å³ä¸‹è§’é¡¯ç¤ºè­¦ç¤ºæ¡†ï¼Œå…§å®¹ç‚ºã€Œæœ‰æ–°å…§å®¹å¯ç”¨ã€ã€‚é»æ“Šã€Œé‡æ–°æ•´ç†ã€æŒ‰éˆ•å¾Œï¼Œé é¢ä¸»æ¨™é¡Œå¾ã€Œä»‹ç´¹ã€è®Šæ›´ç‚ºã€ŒPWA :))ã€ã€‚](/img/pwa_reload.gif)

æ‚¨çš„å…ƒä»¶å¯ä»¥æ¸²æŸ“ç‚º `null`ï¼Œä½†ä¸å»ºè­°é€™éº¼åšï¼šä½¿ç”¨è€…å°‡ç„¡æ³•å–å¾—æœ€æ–°å…§å®¹ã€‚