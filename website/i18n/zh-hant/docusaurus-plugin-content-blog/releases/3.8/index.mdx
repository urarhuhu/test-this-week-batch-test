---
title: Docusaurus 3.8
authors: [slorber]
tags: [release]
image: ./img/social-card.png
date: 2025-05-26
---

我們很高興宣布推出 **Docusaurus 3.8**。

此版本提升了建置效能、新增多項功能，並引入「未來標誌」(Future Flags) 來協助您為 Docusaurus 4 做好準備。

升級過程十分簡單。我們遵循[語意化版本控制](https://semver.org/)，根據我們的[發布流程](/community/release-process)，次要版本更新**不會包含破壞性變更**。

![Docusaurus 部落格文章社交卡片](./img/social-card.png)

```mdx-code-block
import BrowserWindow from '@site/src/components/BrowserWindow';
import IframeWindow from '@site/src/components/BrowserWindow/IframeWindow';
import NavbarColorModeToggle from '@theme/Navbar/ColorModeToggle';
```

## 效能表現

此版本透過多項優化與 2 個新的 Docusaurus Faster 選項，持續提升我們的建置基礎架構效能。

### Docusaurus Faster

[Docusaurus Faster](https://github.com/facebook/docusaurus/issues/10556) 已在 [Docusaurus v3.6](/blog/releases/3.6#docusaurus-faster) 中引入，讓您能選擇啟用我們升級後的建置基礎架構，大幅加速網站建置。這些實驗性標誌可個別啟用，但我們建議透過以下便捷捷徑一次全部啟用：

```js
const config = {
  future: {
    // highlight-next-line
    experimental_faster: true,
  },
};
```

:::tip

別忘了先安裝 `@docusaurus/faster` 相依套件！

:::

#### 持久化快取

在 [#10931](https://github.com/facebook/docusaurus/pull/10931) 中，我們啟用了 **[Rspack 持久化快取](https://rspack.dev/blog/announcing-1-2#persistent-cache)**。與 [Webpack 持久化快取](https://webpack.js.org/blog/2020-10-10-webpack-5-release/#persistent-caching)（已支援）類似，它能大幅加速後續建置時的 Docusaurus 應用程式打包過程。

實際應用中，當您第二次執行 `docusaurus build` 時，網站建置速度應會明顯提升。

此功能需使用 [Rspack 打包工具](https://rspack.dev/)，並可透過 `rspackPersistentCache` 標誌啟用：

```js
const config = {
  future: {
    experimental_faster: {
      // highlight-start
      rspackBundler: true, // required flag
      rspackPersistentCache: true, // new flag
      // highlight-end
    },
  },
};
```

:::caution[保留快取]

持久化快取需在多次建置間保留 `./node_modules/.cache` 資料夾。

Netlify 和 Vercel 等主流 CDN 會自動為您處理此事。根據您的 CI 與部署流程，可能需要額外設定來保留快取。

:::

**成果**：平均而言，您可預期網站打包時間在重建時加速約 **2-5 倍** 🔥。若您[停用可選的 `concatenateModule` 優化](https://github.com/facebook/docusaurus/discussions/11199)，效果將更為顯著。

#### 工作執行緒

在 [#10826](https://github.com/facebook/docusaurus/pull/10826) 中，我們引入了 [Node.js 工作執行緒池](https://github.com/tinylibs/tinypool)來執行靜態網站生成程式碼。透過此新策略，我們能更有效運用所有可用 CPU、減少靜態網站生成時間，並抑制潛在記憶體洩漏。

此功能可透過 `ssgWorkerThreads` 標誌啟用，且需同時啟用 [`v4.removeLegacyPostBuildHeadAttribute`](#postbuild-change) 未來標誌：

```js
const config = {
  future: {
    v4: {
      // highlight-next-line
      removeLegacyPostBuildHeadAttribute: true, // required
    },
    experimental_faster: {
      // highlight-next-line
      ssgWorkerThreads: true,
    },
  },
};
```

**成果**：平均而言，您可預期網站靜態生成時間加速約 **2 倍** 🔥。此數據於 MacBook Pro M3 上測得，實際效果可能因 CI 環境而異。

### 其他優化

我們發現並解決了數個主要效能瓶頸，包括：

- 在 [#11007](https://github.com/facebook/docusaurus/pull/11007) 中，我們針對 macOS 使用者優化了開發伺服器的啟動時間。我們發現原先用來開啟瀏覽器的程式碼使用了耗時的同步/阻塞式呼叫，這阻礙了打包工具的工作效率。現在起，打包工具與 macOS 瀏覽器開啟程序將會並行運作，為所有 macOS 使用者帶來更快速的 `docusaurus start` 體驗。
- 在 [#11163](https://github.com/facebook/docusaurus/pull/11163) 中，我們注意到文件系統的 `showLastUpdateAuthor` 和 `showLastUpdateTime` 功能相當耗費資源，需要為每個文件執行 `git log` 命令。在大型網站上，並行執行這些命令可能導致系統資源耗盡，並引發 Node.js 的 `EBADF` 錯誤。我們實作了 Git 命令佇列機制來避免系統過載，同時也略微提升了插件 `loadContent()` 生命週期的效能。
- 在 [#10885](https://github.com/facebook/docusaurus/pull/10885) 中，我們為外部連結圖標實作了 SVG 精靈圖(sprite)。由於該圖標在網站各處（導航欄、頁腳、側邊欄...）重複出現，使用 React SVG 元件會導致最終 HTML 中出現重複的 SVG 標記。採用精靈圖技術只需嵌入圖標 SVG 一次，減少了生成的 HTML 體積和靜態生成時間。我們[計劃未來使用更多 SVG 精靈圖](https://github.com/facebook/docusaurus/issues/5865)。
- 在 [#11176](https://github.com/facebook/docusaurus/pull/11176) 中，我們微調了 webpack/Rspack 配置，移除了不必要的優化選項。

:::tip

若打包時間是您關注的重點，可以考慮停用可選的 `concatenateModule` 打包器優化選項。我們在[此處](https://github.com/facebook/docusaurus/discussions/11199)說明了取捨關係與操作方式。此選項僅節省 3% 的 JavaScript 體積，但對於超大型網站而言，這項變更帶來了驚人的效能提升：冷建置速度提升 4 倍，重建速度提升 16 倍 🔥。

:::

### 成效影響

我們已將 [React Native 官方網站升級至 Docusaurus v3.8](https://github.com/facebook/react-native-website/pull/4607)。以下是針對約 2000 頁面的網站，展示 Docusaurus Faster 對整體建置時間影響的最新基準測試：

| ReactNative.dev       | Cold Build         | Warm Rebuild       |
| --------------------- | ------------------ | ------------------ |
| 🐢 Docusaurus Slower  | 120s (baseline)    | 33s (3.6 × faster) |
| ⚡️ Docusaurus Faster | 31s (3.8 × faster) | 17s (7 × faster)   |

在我們的官方網站上也測得相似結果：

| Docusaurus.io         | Cold Build         | Warm Rebuild       |
| --------------------- | ------------------ | ------------------ |
| 🐢️ Docusaurus Slower | 146s (baseline)    | 45s (3.2 × faster) |
| ⚡️ Docusaurus Faster | 42s (3.5 × faster) | 24s (6.1 × faster) |

您還可以預期記憶體使用率的改善，以及更快速的 `docusaurus start` 體驗。

## 未來標誌 (Future Flags)

Docusaurus v4 的「未來標誌」讓您能**選擇性啟用即將到來的 Docusaurus v4 破壞性變更**，並協助您逐步管理這些變更，一次處理一項。啟用所有未來標誌將使您的網站更容易在 Docusaurus v4 發布時進行升級。

:::info[非原創概念]

「未來標誌」的概念並非我們首創。它是由 Remix 社群推廣開來的。您可以在此閱讀更多關於這種漸進式功能採用策略的資訊：

- [透過未來標誌實現漸進式功能採用](https://remix.run/docs/en/main/guides/api-development-strategy)
- [讓您的 Remix 應用面向未來](https://remix.run/blog/future-flags)

:::

:::tip[一次性啟用所有 v4 未來標誌]

您可以使用以下快捷方式一次性啟用所有 v4 未來標誌：

```js
const config = {
  future: {
    // highlight-next-line
    v4: true,
  },
};
```

如此一來，您就能確保網站始終為 Docusaurus v4 做好準備。請注意我們會在後續次要版本中引入更多未來標誌。升級時，請務必閱讀我們的版本發布部落格文章，以了解您選擇加入的新破壞性變更內容。

:::

### CSS 層疊規則 (CSS Cascade Layers)

在 Docusaurus v4 中，我們計劃運用 [CSS 層疊層級](https://css-tricks.com/css-cascade-layers/)。這項現代 CSS 功能已獲廣泛支援，可將 CSS 規則分組至不同特異性層級中。此功能特別有助於讓您更精準控制 CSS 層疊順序，使 CSS 規則較不受插入順序影響。現在您未分層的規則將始終能覆蓋我們提供的分層 CSS。

在 [#11142](https://github.com/facebook/docusaurus/pull/11142) 中，我們實作了實驗性的 [`@docusaurus/plugin-css-cascade-layers`](/docs/api/plugins/@docusaurus/plugin-css-cascade-layers) 插件。若您使用經典預設配置，可透過 `v4.useCssCascadeLayers` 旗標啟用此功能：

```js
export default {
  future: {
    v4: {
      // highlight-next-line
      useCssCascadeLayers: true,
    },
  },
};
```

我們將此功能視為**破壞性變更**，因為它可能輕微改變客製化網站中的 CSS 規則應用順序。這類問題通常影響有限且易於修復（例如參見 [React Native 的 CSS 調整](https://github.com/facebook/react-native-website/pull/4607)）。未提供自訂 CSS 且未置換任何元件的網站應不受影響。

實際應用上，它能自動將內建的 CSS 層疊層級套用至我們提供的所有 CSS，包括我們採用的意見式 CSS 框架 [Infima](https://infima.dev/)：

```css
@layer docusaurus.infima {
  h1 {
    /* Infima css rules */
  }
  pre {
    /* Infima css rules */
  }
}
```

層級功能有助解決長期存在的[全域 CSS 污染問題](https://github.com/facebook/docusaurus/issues/6032)。我們的內建全域 CSS 規則可能與您的規則衝突，使得在 Docusaurus 中建立隔離於我們 CSS 之外的遊樂場、演示和嵌入式小工具更為困難。值得慶幸的是，[CSS 層疊層級可被還原](https://mayank.co/blog/revert-layer/)以建立不受 Docusaurus 提供之 CSS 影響的 HTML 子樹。

<details>
  <summary>Reverting layers</summary>

As [this issue](https://github.com/facebook/docusaurus/pull/11142) and [this blog post](https://mayank.co/blog/revert-layer/) explain, it is possible to revert layers to isolate an HTML subtree from the CSS that comes from that layer.

In practice, you can create a `.my-playground` class to revert the global CSS coming from Infima:

```css
/* The "impossible" :not() selector helps increase the specificity */
.my-playground:not(#a#b) {
  &,
  * {
    @layer docusaurus.infima {
      all: revert-layer;
    }
  }
}
```

Then you can apply this class to any HTML element, so that Infima doesn't apply to any of its children. The HTML subtree becomes isolated from our built-in CSS.

```mdx-code-block
<IframeWindow url="/tests/pages/style-isolation?docusaurus-data-navbar=false" />
```

</details>

### `postBuild()` 變更

在 [#10850](https://github.com/facebook/docusaurus/pull/10850) 中，我們新增了 `removeLegacyPostBuildHeadAttribute` 未來旗標，輕微變更了 `postBuild()` 插件生命週期方法的簽名，移除了 `head` 屬性。

```js
export default {
  future: {
    v4: {
      // highlight-next-line
      removeLegacyPostBuildHeadAttribute: true,
    },
  },
};
```

此遺留資料結構源自 [react-helmet-async](https://github.com/staylor/react-helmet-async) 依賴項，本就不應作為公開 API 暴露。因其不可序列化，阻礙了我們實作[靜態網站生成的 Worker Threads](#worker-threads)。

雖然技術上屬於**破壞性變更**，我們認為此變更不會影響任何人。我們未發現任何開源插件使用該方法接收的 `head` 參數。若啟用此旗標導致您的網站異常，請[在此告知我們](https://github.com/facebook/docusaurus/pull/10850)。

## 系統色彩模式

在 [#10987](https://github.com/facebook/docusaurus/pull/10987) 中，經典主題現允許您將色彩模式還原為系統/作業設定值。

```mdx-code-block
<BrowserWindow>
  <div
    className="margin-vert--md"
    style={{display: 'flex', justifyContent: 'center'}}>
    <NavbarColorModeToggle />
  </div>
</BrowserWindow>
```

## 代碼區塊重構

在 [#11058](https://github.com/facebook/docusaurus/pull/11058)、[#11059](https://github.com/facebook/docusaurus/pull/11059)、[#11062](https://github.com/facebook/docusaurus/pull/11062) 和 [#11077](https://github.com/facebook/docusaurus/pull/11077) 中，主題代碼區塊元件已大幅重構，現在應更易於置換與擴展。

根據我們的[發布流程](/community/release-process)，此非破壞性變更，但已置換這些元件的網站可能需要升級它們。

## 翻譯

- 🇹🇷 [#10893](https://github.com/facebook/docusaurus/pull/10893): 新增土耳其語主題翻譯缺失內容。
- 🇵🇱 [#10884](https://github.com/facebook/docusaurus/pull/10884): 新增波蘭語主題翻譯缺失內容。
- 🇨🇳 [#10816](https://github.com/facebook/docusaurus/pull/10816): 新增中文主題翻譯缺失內容。
- 🇯🇵 [#11030](https://github.com/facebook/docusaurus/pull/11030): 新增日語主題翻譯缺失內容。

## 維護更新

Docusaurus 3.8 已支援 [Node.js 24](https://github.com/facebook/docusaurus/pull/11168) 和 [TypeScript 5.8](https://github.com/facebook/docusaurus/pull/10966)。

我們同時移除了無用的 npm 套件並將未維護的套件內部化：

- 在 [#11010](https://github.com/facebook/docusaurus/pull/11010) 和 [#11014](https://github.com/facebook/docusaurus/pull/11014) 中，我們將 `@docusaurus/plugin-ideal-image` 使用的未維護套件 `react-ideal-image` 和 `react-waypoint` 內部化，並使其相容於 React 19。
- 在 [#10956](https://github.com/facebook/docusaurus/pull/10956) 中，我們移除了對未維護套件 `react-dev-utils`（來自 Create-React-App）的依賴。
- 在 [#10358](https://github.com/facebook/docusaurus/pull/10358) 中，我們以 `execa` 取代了未維護的 `shelljs` 套件。
- 在 [#11138](https://github.com/facebook/docusaurus/pull/11138) 中，我們移除了 `reading-time` 套件，改用內建的標準 API `Intl.Segmenter` 來計算部落格文章的閱讀時間。
- 在 [#11037](https://github.com/facebook/docusaurus/pull/11037) 中，我們移除了無用的 `clean-webpack-plugin`。

## 其他變更

其他值得注意的變更包括：

- 在 [#10852](https://github.com/facebook/docusaurus/pull/10852) 中，主題的 `docsVersionDropdown` 導航欄項目現在接受 `versions` 屬性。
- 在 [#10953](https://github.com/facebook/docusaurus/pull/10953) 中，`@docusaurus/remark-plugin-npm2yarn` 外掛現在預設支援 Bun 標籤轉換。
- 在 [#10945](https://github.com/facebook/docusaurus/pull/10945) 中，主佈景主題佈局元素現在套用了更穩定的 CSS 類別，讓你能建立更可靠的 CSS 選擇器。
- 在 [#10846](https://github.com/facebook/docusaurus/pull/10846) 中，Markdown 程式碼區塊的 `showLineNumbers` 元字串現在可以接受數字來初始化行號計數器的起始值。
- 在 [#11090](https://github.com/facebook/docusaurus/pull/11090) 中，我們讓自訂頁面標題格式化器更容易使用。
- 在 [#11088](https://github.com/facebook/docusaurus/pull/11088) 中，頁面外掛現在支援 `frontMatter.slug`，如同文件和部落格外掛已經支援的功能。
- 在 [#10875](https://github.com/facebook/docusaurus/pull/10875) 中，文件版本控制 CLI 現在也會複製本地化的文件 JSON 翻譯檔案。

查看 **[3.8.0 變更日誌條目](/changelog/3.8.0)** 以獲取完整的變更列表。